@page "/"
@using Stripe.Checkout
@inject NavigationManager NavMan
@rendermode InteractiveWebAssembly

<PageTitle>Widget Sale!</PageTitle>

<section class="border p-4 bg-light">
    <label>Order id(enter some number):</label>
    <input @bind-value="OrderId" />
    <label for="priceInput">Price ($):</label>
    <input type="number" @bind-value="Price" />
    <form method="post" @formname="checkout" @onsubmit="Checkout">

        <button type="submit" class="btn btn-primary">
            Place Order
        </button>
        <AntiforgeryToken />
    </form>

</section>

@code {
    private string? OrderId{ get; set; }
    private int Price { get; set; }

    private async Task Checkout()
    {
        var domain = "https://localhost:7095";
        var options = new SessionCreateOptions
            {
                LineItems = new List<SessionLineItemOptions>
            {
                new()
                {
                    PriceData = new()
                    {
                        UnitAmount = Convert.ToInt16(Price) * 100, // цена в центах (например, £49 = 4900)
                        Currency = "usd",
                        ProductData = new()
                        {
                            Name = $"Order#{OrderId??"111"}",
                        }
                    },
                    Quantity = 1,
                },
            },
                Mode = "payment",
                SuccessUrl = domain + "/OrderComplete",
                CancelUrl = domain + "/OrderAbandoned"
            };
        var service = new SessionService();
        var session = await service.CreateAsync(options);
        NavMan.NavigateTo(session.Url);
    }
}
